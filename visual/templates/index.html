{% extends 'base.html' %}
{% load static %}

{% block content_table %}
{% if observation_list %}

    <!-- Content -->
    <div class="table-container" style="overflow:auto;">
        {% block table %}
            <h2> COVID19 Confirmed Cases</h2>
            <table>
                {% block table.thead %}
                    <thead {{ table.attrs.thead.as_html }}>
                        <tr>
                            <th> Country</th>
                            <th> Province </th>
                            <th> Confirmed Case </th>
                            <th> Death Case </th>
                        </tr>
                    </thead>
                {% endblock table.thead %}
                {% block table.tbody %}
                    <tbody {{ table.attrs.tbody.as_html }}>
                    {% for observation in observation_list %}
                        {% block table.tbody.row %}
                        <tr {{ row.attrs.as_html }}>
                            {% for k, v in observation.items%}
                                <td {{ column.attrs.td.as_html }}>{{v}}</td>
                            {% endfor %}
                        </tr>
                        {% endblock table.tbody.row %}
                    {% endfor %}
                    </tbody>
                {% endblock table.tbody %}
            </table>
        {% endblock table %}
    </div>


{% else %}
    <p>No observations are available.</p>
{% endif %}
{%  endblock %}


{% block content_chart %}

    <div class="chart-container" style="position: relative; height:25vh; width:50vw">
    {#    <canvas id="covid_chart" data-url="{% url 'covid_chart' %}"></canvas>#}
    <canvas id="covid_chart" data-url=""></canvas>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script>

        $('#search_form').submit(function(e) {
            e.preventDefault();
            var country = $("#country").val();
            console.log(country);
            url_str = "http://127.0.0.1:8000/visual/covid_chart/?country=" + country;
            console.log(url_str);
            var covidChart = $("#covid_chart"); {#Get the bar chart canvas id#}
            var covidAreaChart = $("#covid_area_chart"); {#Get the Area Chart canvas id#}

            {# Call The Ajax for bar chart#}
            $.ajax({
                url : url_str,
                success: function (data) {
                    var ctx = covidChart[0].getContext("2d");

                    window.myObjBar = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.labels,
                            datasets: [{
                            label: 'Covid Confirmed Case',
                            backgroundColor: ['orange', 'blue', 'green', 'red', 'violet', 'purple'],
                            data: data.data
                            }]
                        },
                        options: {
                            responsive: true,
                                legend: {
                                    position: 'top',
                                },
                            title: {
                                display: true,
                                text: 'COVID19 Confirmed Case Bar Chart'
                            }
                        }
                    });
                }
            });

            {# Call The Ajax for Area chart #}
            $.ajax({
                url : url_str,
                success: function (data) {
                    var ctx = covidAreaChart[0].getContext("2d");

                    new Chart(ctx, {
                        type: 'polarArea',
                        data: {
                            labels: data.labels,
                            datasets: [{
                                label: 'Covid Confirmed Case',
                                fill: false,
                                backgroundColor: ['orange', 'blue', 'green', 'red', 'violet', 'purple'],
                                data: data.data
                            }]
                        },
                        options: {
                            responsive: true,
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'COVID19 Confirmed Case Polar Area Chart'
                            },
                        }
                    });
                }
            });
        });


        $(function () {
            var covidChart = $("#covid_chart");
            var country = "";
            $('#search_form').submit(function() {
                country = $("#country").val();
            });
            $.ajax({
                url : "http://127.0.0.1:8000/visual/covid_chart/",
                success: function (data) {
                    var ctx = covidChart[0].getContext("2d");

                    window.myObjBar = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: data.labels,
                            country: country,
                            datasets: [{
                            label: 'Covid Confirmed Case',
                            backgroundColor: ['orange', 'blue', 'green', 'red', 'violet', 'purple'],
                            data: data.data
                            }]
                        },
                        options: {
                            responsive: true,
                                legend: {
                                    position: 'top',
                                },
                            title: {
                                display: true,
                                text: 'COVID19 Confirmed Case Bar Chart'
                            }
                        }
                    });
                }
            });

        });

    </script>

{% endblock %}

{% block content_area_chart %}

    <div class="chart-container" style="position: relative; height:25vh; width:35vw">
    {#    <canvas id="covid_chart" data-url="{% url 'covid_chart' %}"></canvas>#}
    <canvas id="covid_area_chart" data-url=""></canvas>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script>
        $(function () {
            var covidAreaChart = $("#covid_area_chart");
            $.ajax({
                url : "http://127.0.0.1:8000/visual/covid_chart/",
                success: function (data) {
                    var ctx = covidAreaChart[0].getContext("2d");

                    new Chart(ctx, {
                        type: 'polarArea',
                        data: {
                            labels: data.labels,
                            datasets: [{
                                label: 'Covid Confirmed Case',
                                fill: false,
                                backgroundColor: ['orange', 'blue', 'green', 'red', 'violet', 'purple'],
                                data: data.data
                            }]
                        },
                        options: {
                            responsive: true,
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'COVID19 Confirmed Case Polar Area Chart'
                            },
                        }
                    });
                }
            });
        });

    </script>

{% endblock %}


{% block content_line_chart %}

    <div class="chart-container" style="position: relative; height:25vh; width:35vw">
    {#    <canvas id="covid_chart" data-url="{% url 'covid_chart' %}"></canvas>#}
        <canvas id="covid_line_chart" data-url=""></canvas>
    </div>

    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script>

        $(function () {
            var covidLineChart = $("#covid_line_chart");
            $.ajax({
                url : "http://127.0.0.1:8000/visual/covid_line_chart/",
                success: function (data) {
                    var ctx = covidLineChart[0].getContext("2d");

                    new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: data.labels,
                            datasets: [{
                                label: 'Covid Death Case',
                                fill: false,
                                backgroundColor: ['orange', 'blue', 'green', 'red', 'violet', 'purple'],
                                data: data.data
                            }]
                        },
                        options: {
                            responsive: true,
                            legend: {
                                position: 'top',
                            },
                            title: {
                                display: true,
                                text: 'COVID19 Death Case Line Chart'
                            },
                        }
                    });
                }
            });
        });

    </script>

{% endblock %}
